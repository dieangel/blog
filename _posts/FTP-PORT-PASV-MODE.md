---
title: FTP的主动模式(PORT)与被动模式(PASV)
toc: true
date: 2017-01-04 22:47:43
tags: FTP
categories: Work
---
在服务器间进行数据传输的时候经常采用ftp协议，但是又要进行安全策略的控制，有的时候会出现连接失败的问题。所以研究一下这两者之间的不同。
<!--more-->
# 控制连接与数据连接
FTP的控制连接与数据连接是分开的。只有在需要数据连接的时候才会打开，用完则会进行关闭。
PORT与PASV的区别就在于打开数据连接的流程和方式不同。
# PASV模式
大多数客户端(LINUX ftp命令)都用的这种模式。
在需要打开数据连接的时候， 其基本流程是:
- 客户端请求一个数据传送
- 服务端将开放的数据端口发送给客户端
- 客户端连接此端口
- 传输数据
![ftp的pasv模式展示](/res/20170104-ftp-01.png)
# PORT模式
PORT模式是由客户端选择一端口进行开放，然后服务端通过20端口进行连接后传输数据。其流程为:
- 客户端发送PORT命令(包含数据端口)
- 服务端连接客户端的数据端口
- 传输数据
![ftp的PORT模式展示](/res/20170104-ftp-02.png)
# 访问策略的注意
服务器间通过FTP进行数据传输的时候，作为服务端，21端口是必须进行允许要进行上传或者下载的IP进行连接。
默认情况下，客户端都是采用的PASV模式进行传输，那么就是需要由服务端告知数据段口，客户端进行连接。
在iptables的默认策略是ACCPET的情况下，这并没有什么问题，但是如果默认策略是REJECT就得小心了。
而对于采用主动模式PORT的客户端，则就必须对进入的流量包进行一个允许了。
